<?xml version="1.0" encoding="utf-8"?>
<!-- steps to add to build additions -->
<root xmlns:android="http://schemas.android.com/apk/res/android">
	<!-- init section is always evaluated once per architecture -->
	<init>
	    <setBool result="bSupported" value="false"/>
	        <isArch arch="armeabi-v7a">
	            <setBool result="bSupported" value="true"/>
	        </isArch>
			<isArch arch="arm64-v8a">
	            <setBool result="bSupported" value="true"/>
	        </isArch>
	</init>

	<!-- optional files or directories to copy to Intermediate/Android/APK -->
	<resourceCopies>
		<log text="PluginDir: $S(PluginDir)"/>
			<copyFile src="$S(PluginDir)/$S(Architecture)/libtxffmpeg.so"
	                  dst="$S(BuildDir)/libs/$S(Architecture)/libtxffmpeg.so" />
            <copyFile src="$S(PluginDir)/$S(Architecture)/libtxsoundtouch.so"
	                  dst="$S(BuildDir)/libs/$S(Architecture)/libtxsoundtouch.so" />
	        <copyFile src="$S(PluginDir)/$S(Architecture)/libliteavsdk.so"
	                  dst="$S(BuildDir)/libs/$S(Architecture)/libliteavsdk.so" />
			<copyFile src="$S(PluginDir)/liteavsdk.jar"
					dst="$S(BuildDir)/libs/liteavsdk.jar" />
	</resourceCopies>
	
	<buildGradleAdditions>
		<insert>
		dependencies {
			implementation fileTree(dir: 'src/main/libs', include: ['*.jar'])
		}
		</insert>
  	</buildGradleAdditions>

	<androidManifestUpdates>
		<addPermission android:name="android.permission.INTERNET" />
		<addPermission android:name="android.permission.ACCESS_NETWORK_STATE" />
		<addPermission android:name="android.permission.ACCESS_WIFI_STATE" />
		<addPermission android:name="android.permission.CAMERA" />
		<addPermission android:name="android.permission.RECORD_AUDIO" />
		<addPermission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />
		<addPermission android:name="android.permission.BLUETOOTH" />
		<addPermission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
		<addPermission android:name="android.permission.READ_EXTERNAL_STORAGE" />
		<addPermission android:name="android.permission.READ_PHONE_STATE" />
		<uses-feature android:name="android.hardware.camera" />
		<uses-feature android:name="android.hardware.camera.autofocus" />
    </androidManifestUpdates>

	<!-- optional libraries to load in GameActivity.java before libUE4.so -->
	<soLoadLibrary>
	    <if condition="bSupported">
	        <true>
				<loadLibrary name="liteavsdk" failmsg="Failed to load liteavsdk library" />
				<loadLibrary name="txsoundtouch" failmsg="Failed to load txsoundtouch library" />
				<loadLibrary name="txffmpeg" failmsg="Failed to load txffmpeg library" />
			</true>
	    </if>
	</soLoadLibrary>

	<gameActivityImportAdditions>
        <insert>
            import android.util.Base64;
			import org.json.JSONException;
			import org.json.JSONObject;
			import java.io.UnsupportedEncodingException;
			import java.nio.charset.Charset;
			import java.security.InvalidKeyException;
			import java.security.NoSuchAlgorithmException;
			import java.util.Arrays;
			import java.util.zip.Deflater;
			import javax.crypto.Mac;
			import javax.crypto.spec.SecretKeySpec;
        </insert>
    </gameActivityImportAdditions>
	
	<proguardAdditions>
    <insert>
      -keep class com.tencent.** { *; }
    </insert>
  </proguardAdditions>
</root>